<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Chat - DeepSeek</title>
    <style>
        /* ‰∏ªÈ¢òÂèòÈáè - Ê∑ªÂä†Âú®Ê†∑ÂºèË°®ÂºÄÂ§¥ */
        :root {
            /* ÊµÖËâ≤‰∏ªÈ¢òÂèòÈáè (ÈªòËÆ§) */
            --bg-color: rgba(245, 247, 250, 0.5);
            --text-color: #333;
            --secondary-text: #666;
            --primary-color: #4a90e2;
            --primary-dark: #356bb7;
            --panel-bg: rgba(255, 255, 255, 0.12);
            --card-bg: rgba(255, 255, 255, 0.8);
            --user-message-bg: linear-gradient(135deg, #4a90e2 0%, #356bb7 100%);
            --user-message-color: white;
            --ai-message-bg: rgba(255, 255, 255, 0.8);
            --ai-message-color: #333;
            --ai-thinking-bg: rgba(255, 255, 255, 0.6);
            --ai-thinking-color: #666;
            --input-bg: rgba(255, 255, 255, 0.6);
            --border-color: rgba(255, 255, 255, 0.2);
            --sidebar-bg: rgba(44, 62, 80, 0.8);
            --sidebar-text: #fff;
            --sidebar-active: rgba(74, 144, 226, 0.5);
            --sidebar-hover: rgba(74, 144, 226, 0.3);
            --modal-bg: rgba(255, 255, 255, 0.9);
            --modal-header: #333;
            --settings-border: rgba(0, 0, 0, 0.1);
            --input-border: rgba(0, 0, 0, 0.1);
            --toast-bg: rgba(0, 0, 0, 0.8);
            --toast-color: white;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --context-menu-bg: rgba(255, 255, 255, 0.85);
            --context-menu-color: #333;
            --context-menu-hover: rgba(74, 144, 226, 0.1);
            --danger-color: #e74c3c;
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢òÂèòÈáè */
        [data-theme="dark"] {
            --bg-color: rgba(30, 39, 46, 0.5);
            --text-color: #e2e2e2;
            --secondary-text: #b0b0b0;
            --primary-color: #5f9de6;
            --primary-dark: #4a7dbe;
            --panel-bg: rgba(35, 43, 50, 0.15);
            --card-bg: rgba(35, 43, 50, 0.8);
            --user-message-bg: linear-gradient(135deg, #5f9de6 0%, #4a7dbe 100%);
            --user-message-color: white;
            --ai-message-bg: rgba(45, 53, 60, 0.8);
            --ai-message-color: #e2e2e2;
            --ai-thinking-bg: rgba(45, 53, 60, 0.6);
            --ai-thinking-color: #b0b0b0;
            --input-bg: rgba(45, 52, 58, 0.6);
            --border-color: rgba(80, 80, 80, 0.2);
            --sidebar-bg: rgba(25, 33, 42, 0.85);
            --sidebar-text: #e2e2e2;
            --sidebar-active: rgba(74, 144, 226, 0.45);
            --sidebar-hover: rgba(74, 144, 226, 0.25);
            --modal-bg: rgba(35, 43, 50, 0.9);
            --modal-header: #e2e2e2;
            --settings-border: rgba(80, 80, 80, 0.2);
            --input-border: rgba(80, 80, 80, 0.3);
            --toast-bg: rgba(35, 43, 50, 0.9);
            --toast-color: #e2e2e2;
            --shadow-color: rgba(0, 0, 0, 0.25);
            --context-menu-bg: rgba(35, 43, 50, 0.95);
            --context-menu-color: #e2e2e2;
            --context-menu-hover: rgba(74, 144, 226, 0.2);
            --danger-color: #e9675c;
        }

        /* ‰ΩøÁî®ÂèòÈáèÊõøÊç¢È¢úËâ≤ÂÄº */
        body {
            color: var(--text-color);
        }

        .chat-container {
            background: var(--panel-bg);
            box-shadow: 0 8px 32px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .chat-messages {
            background: var(--bg-color);
        }

        .message-header {
            color: var(--text-color);
        }

        .user-message {
            background: var(--user-message-bg);
            color: var(--user-message-color);
        }

        .ai-message {
            background: var(--ai-message-bg);
            color: var(--ai-message-color);
        }

        .ai-thinking {
            background: var(--ai-thinking-bg);
            color: var(--ai-thinking-color);
            border-left: 3px solid var(--primary-color);
        }

        .thinking-header {
            color: var(--secondary-text);
        }

        .chat-input-container {
            background: var(--panel-bg);
            border-top: 1px solid var(--border-color);
        }

        .toggle-label {
            color: var(--text-color);
        }

        #chatInput {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        #chatInput:focus {
            border-color: var(--primary-color);
            background: var(--input-bg);
        }

        #sendButton {
            background: var(--primary-color);
        }

        #sendButton:hover {
            background: var(--primary-dark);
        }

        /* Ê∏©Â∫¶ÊªëÂùó */
        .temperature-label {
            color: var(--text-color);
        }

        .temperature-value {
            color: var(--primary-color);
        }

        .temperature-slider {
            background: var(--input-border);
        }

        .temperature-slider::-webkit-slider-thumb {
            background: var(--primary-color);
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal-content {
            background: var(--modal-bg);
        }

        .modal-header h2 {
            color: var(--modal-header);
        }

        .settings-section {
            border-bottom: 1px solid var(--settings-border);
        }

        .settings-section h3 {
            color: var(--text-color);
        }

        .settings-item label {
            color: var(--secondary-text);
        }

        .settings-item input,
        .settings-item select {
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text-color);
        }

        .settings-item input:focus,
        .settings-item select:focus {
            border-color: var(--primary-color);
        }

        .api-key-input button {
            border: 1px solid var(--input-border);
            border-left: none;
            background: var(--input-bg);
            color: var(--text-color);
        }

        /* Âè≥ÈîÆËèúÂçïÊ†∑Âºè */
        .context-menu {
            background: var(--context-menu-bg);
            border: 1px solid var(--border-color);
        }
        
        .context-menu-item {
            color: var(--context-menu-color);
        }
        
        .context-menu-item:hover {
            background: var(--context-menu-hover);
        }
        
        .context-menu-item.danger {
            color: var(--danger-color);
        }
        
        .context-menu-divider {
            background: var(--settings-border);
        }

        /* ÊèêÁ§∫Ê∂àÊÅØ */
        .toast {
            background: var(--toast-bg);
            color: var(--toast-color);
        }

        /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ */
        .theme-toggle {
            position: fixed;
            top: 20px;           /* ‰ªébottom: 20pxÊîπ‰∏∫top: 20px */
            right: 20px;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            z-index: 100;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            color: var(--primary-color);
        }

        /* Âü∫Á°ÄÊ†∑ÂºèË∞ÉÊï¥ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: url('https://source.unsplash.com/random/1920x1080/?gradient') no-repeat center center fixed;
            background-size: cover;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Ê®°Á≥äÁéªÁíÉÊïàÊûú */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* ËÅäÂ§©Áõ∏ÂÖ≥Ê†∑Âºè‰ºòÂåñ */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            margin: 10px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .chat-list {
            width: 280px;
            background: rgba(44, 62, 80, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: #fff;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            padding: 20px 15px;
        }

        .chat-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px 15px 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }

        .chat-list-title {
            font-weight: 600;
            font-size: 18px;
        }

        .new-chat-btn {
            padding: 6px 12px;
            background: rgba(74, 144, 226, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .new-chat-btn:hover {
            background: rgba(74, 144, 226, 0.9);
            transform: translateY(-2px);
        }

        .chat-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-icon {
            font-size: 16px;
        }

        .chat-item:hover {
            background: rgba(74, 144, 226, 0.3);
            transform: translateY(-2px);
        }

        .chat-item.active {
            background: rgba(74, 144, 226, 0.5);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            background: rgba(245, 247, 250, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .message {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease;
            line-height: 1.5;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .message-header {
            font-size: 13px;
            margin-bottom: 5px;
            opacity: 0.8;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #4a90e2 0%, #356bb7 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .ai-thinking {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            color: #666;
            border-bottom-left-radius: 4px;
            font-style: italic;
            border-left: 3px solid #4a90e2;
            max-height: 300px;
            overflow-y: auto;
        }

        .thinking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
            color: #666;
        }

        .message-time {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-container {
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5px;
        }

        .chat-settings {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #chatInput {
            flex: 1;
            padding: 16px;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #333;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        #chatInput:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
            background: rgba(255, 255, 255, 0.8);
        }

        #sendButton {
            padding: 14px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4a90e2 0%, #356bb7 100%);
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        #sendButton:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }

        #sendButton:disabled {
            background: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* ÂºÄÂÖ≥Ê†∑Âºè */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-label {
            font-size: 13px;
            color: #333;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(200, 200, 200, 0.7);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #4a90e2;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Ê∏©Â∫¶ÊªëÂùó */
        .temperature-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .temperature-label {
            font-size: 13px;
            color: #333;
            font-weight: 500;
            white-space: nowrap;
        }

        .temperature-value {
            font-size: 13px;
            color: #4a90e2;
            font-weight: 600;
            width: 30px;
            text-align: center;
        }

        .temperature-slider {
            -webkit-appearance: none;
            width: 100px;
            height: 6px;
            border-radius: 5px;
            background: rgba(200, 200, 200, 0.7);
            outline: none;
        }

        .temperature-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
            transition: all 0.2s;
        }

        .temperature-slider::-webkit-slider-thumb:hover {
            background: #356bb7;
            transform: scale(1.1);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 10px 0;
            padding: 10px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #4a90e2;
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingAnimation {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ë∞ÉÊï¥ÂÆπÂô®Â∏ÉÂ±Ä */
        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
            padding: 15px;
            background: rgba(0, 0, 0, 0.05);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .chat-list {
                width: 220px;
            }
            .message {
                max-width: 90%;
            }
            .chat-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .container {
                flex-direction: column;
                padding: 5px;
            }
            .chat-list {
                width: 100%;
                height: 60px;
                display: flex;
                align-items: center;
                padding: 0 10px;
                overflow-x: auto;
            }
            .chat-list-header {
                display: none;
            }
            .chat-item {
                margin: 0 5px;
                padding: 8px 12px;
                white-space: nowrap;
            }
            .chat-settings {
                width: 100%;
                justify-content: space-between;
            }
            .theme-toggle {
                top: 15px;
                right: 15px;
                width: 36px;
                height: 36px;
            }
            
            .theme-toggle svg {
                width: 20px;
                height: 20px;
            }
        }

        /* Âè≥ÈîÆËèúÂçïÊ†∑Âºè */
        .context-menu {
            position: fixed;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 160px;
            z-index: 1000;
            overflow: hidden;
            opacity: 0;
            transform: scale(0.95);
            transform-origin: top left;
            transition: all 0.15s ease-out;
            padding: 6px 0;
        }
        
        .context-menu.show {
            opacity: 1;
            transform: scale(1);
        }
        
        .context-menu-item {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .context-menu-item:hover {
            background: rgba(74, 144, 226, 0.1);
        }
        
        .context-menu-item.danger {
            color: #e74c3c;
        }
        
        .context-menu-item.danger:hover {
            background: rgba(231, 76, 60, 0.1);
        }
        
        .context-menu-divider {
            height: 1px;
            background: rgba(0, 0, 0, 0.1);
            margin: 5px 0;
        }
        
        .context-menu-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ÈáçÂëΩÂêçËæìÂÖ•Ê°ÜÊ†∑Âºè */
        .rename-input {
            padding: 6px 10px;
            width: 100%;
            border: 1px solid #4a90e2;
            border-radius: 4px;
            outline: none;
            font-size: 13px;
            background: rgba(255, 255, 255, 0.9);
        }

        /* ËÆæÁΩÆÊåâÈíÆÊ†∑Âºè */
        .settings-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(74, 144, 226, 0.1);
            color: #4a90e2;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(74, 144, 226, 0.2);
            transform: rotate(30deg);
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            width: 500px;
            max-width: 90%;
            max-height: 85vh;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #e74c3c;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 15px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .settings-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .settings-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #444;
        }

        .settings-item {
            margin-bottom: 15px;
        }

        .settings-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }

        .settings-item input,
        .settings-item select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            transition: all 0.3s;
        }

        .settings-item input:focus,
        .settings-item select:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }

        .api-key-input {
            display: flex;
            align-items: center;
        }

        .api-key-input input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .api-key-input button {
            width: 40px;
            height: 41px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-left: none;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
            transition: all 0.3s;
        }

        .api-key-input button:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn.primary {
            background: #4a90e2;
            color: white;
        }

        .btn.primary:hover {
            background: #3a7bc8;
        }

        .btn.secondary {
            background: rgba(0, 0, 0, 0.05);
            color: #666;
        }

        .btn.secondary:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 576px) {
            .modal-content {
                width: 95%;
                max-height: 80vh;
            }
            
            .settings-item {
                margin-bottom: 20px;
            }
        }

        /* Ê∑ªÂä†ToastÊ†∑Âºè */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 12px 24px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 8px;
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ‰∏∫APIËÆæÁΩÆÊåâÈíÆÊ∑ªÂä†Ê†∑Âºè */
        .api-key-notice {
            margin-top: 15px;
            display: flex;
            justify-content: center;
        }

        .setup-api-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .setup-api-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            background: var(--primary-dark);
        }

        .setup-api-btn svg {
            width: 18px;
            height: 18px;
        }

        /* MarkdownÊ†∑Âºè */
        .message-content {
            width: 100%;
        }

        .message-content h1, 
        .message-content h2, 
        .message-content h3,
        .message-content h4, 
        .message-content h5, 
        .message-content h6 {
            margin-top: 12px;
            margin-bottom: 8px;
            font-weight: 600;
            line-height: 1.3;
        }

        .message-content h1 {
            font-size: 1.6em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 4px;
        }

        .message-content h2 {
            font-size: 1.4em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 4px;
        }

        .message-content h3 {
            font-size: 1.2em;
        }

        .message-content p {
            margin-bottom: 10px;
        }

        .message-content ul, 
        .message-content ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .message-content li {
            margin-bottom: 4px;
        }

        .message-content blockquote {
            padding: 0 12px;
            color: var(--secondary-text);
            border-left: 4px solid var(--primary-color);
            margin: 8px 0;
        }

        .message-content pre {
            background: rgba(0, 0, 0, 0.1);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .message-content code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            background: rgba(0, 0, 0, 0.05);
            padding: 3px 5px;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .message-content pre code {
            background: transparent;
            padding: 0;
            border-radius: 0;
            font-size: 0.9em;
            color: inherit;
            display: block;
        }

        .message-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .message-content a:hover {
            text-decoration: underline;
        }

        .message-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }

        .message-content th, 
        .message-content td {
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            text-align: left;
        }

        .message-content th {
            background: rgba(0, 0, 0, 0.05);
        }

        .message-content img {
            max-width: 100%;
            border-radius: 4px;
        }

        /* ÊêúÁ¥¢ÂäüËÉΩÊ†∑Âºè */
        .search-container {
            display: flex;
            margin: 0 0 15px 0;
            padding: 0 5px;
        }

        #searchInput {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px 0 0 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--sidebar-text);
            font-size: 13px;
        }

        #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        #searchInput:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        #searchBtn {
            background: rgba(74, 144, 226, 0.7);
            border: none;
            color: white;
            padding: 8px 10px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #searchBtn:hover {
            background: rgba(74, 144, 226, 0.9);
        }

        .no-search-results {
            padding: 25px 15px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .no-search-results svg {
            opacity: 0.5;
            width: 40px;
            height: 40px;
        }

        .search-result-count {
            padding: 5px 10px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            margin-bottom: 10px;
        }

        .search-highlight {
            background: rgba(74, 144, 226, 0.3);
            border-radius: 3px;
            padding: 0 2px;
            font-weight: bold;
        }

        /* ‰ª£Á†ÅÂ§çÂà∂ÊåâÈíÆÊ†∑Âºè */
        .code-block-wrapper {
            position: relative;
            margin: 10px 0;
        }

        .code-block-wrapper pre {
            margin: 0;
            padding-top: 30px; /* ‰∏∫Â§çÂà∂ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
        }

        .copy-code-button {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 4px;
            color: var(--secondary-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .copy-code-button:hover {
            background: rgba(0, 0, 0, 0.2);
            color: var(--primary-text);
        }

        .copy-code-button.copied {
            background: var(--success-color, #4CAF50);
            color: white;
        }

        /* ÊöóËâ≤‰∏ªÈ¢òË∞ÉÊï¥ */
        .dark-theme .copy-code-button {
            background: rgba(255, 255, 255, 0.1);
            color: var(--secondary-text);
        }

        .dark-theme .copy-code-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--primary-text);
        }

        .dark-theme .copy-code-button.copied {
            background: var(--success-color, #4CAF50);
            color: white;
        }

        /* ÁßªÂä®Á´ØÂìçÂ∫îÂºèÈÄÇÈÖç */
        @media (max-width: 768px) {
            /* Êï¥‰ΩìÂ∏ÉÂ±ÄË∞ÉÊï¥ */
            body {
                overflow: hidden;
            }
            
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr;
            }
            
            /* ‰æßËæπÊ†èÈÄÇÈÖç */
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                bottom: 0;
                width: 280px;
                z-index: 1000;
                transition: left 0.3s ease;
            }
            
            .sidebar.show-mobile {
                left: 0;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            }
            
            /* Ê∑ªÂä†ÈÅÆÁΩ©Â±Ç */
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .sidebar-overlay.show {
                display: block;
                opacity: 1;
            }
            
            /* ‰∏ªÂÜÖÂÆπÂå∫ÂüüÈÄÇÈÖç */
            .main-content {
                grid-column: 1 / -1;
                padding: 0;
            }
            
            /* È°∂ÈÉ®ÂØºËà™Ê†è */
            .mobile-navbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 15px;
                background: var(--bg-gradient);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 900;
            }
            
            .menu-toggle {
                border: none;
                background: transparent;
                color: var(--primary-text);
                padding: 8px;
                cursor: pointer;
                border-radius: 4px;
            }
            
            .menu-toggle:hover {
                background: rgba(255, 255, 255, 0.1);
            }
            
            /* ËÅäÂ§©ÂÆπÂô®ÈÄÇÈÖç */
            .chat-container {
                height: calc(100vh - 60px);
                border-radius: 0;
                margin: 0;
            }
            
            /* Ê∂àÊÅØÊ†∑ÂºèÈÄÇÈÖç */
            .message {
                padding: 12px;
                max-width: 100%;
            }
            
            .message-content {
                font-size: 15px;
            }
            
            /* ËæìÂÖ•Âå∫ÂüüÈÄÇÈÖç */
            .chat-input-container {
                padding: 10px;
                margin: 0;
                border-radius: 0;
            }
            
            #userInput {
                padding: 12px;
                font-size: 15px;
            }
            
            .send-button {
                padding: 10px;
            }
            
            /* ËÆæÁΩÆÂíåÂäüËÉΩÂå∫ÂüüÈÄÇÈÖç */
            .settings-modal {
                width: 90%;
                max-width: 350px;
            }
            
            .toggle-container {
                margin-right: 15px;
            }
            
            /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆÈÄÇÈÖç */
            .theme-toggle {
                width: 36px;
                height: 36px;
                top: auto;
                bottom: 20px;
                z-index: 900;
            }
            
            /* ‰ª£Á†ÅÂùóÈÄÇÈÖç */
            .message-content pre {
                max-width: 100%;
                overflow-x: auto;
            }
            
            /* ‰∏ä‰∏ãÊñáËèúÂçïÈÄÇÈÖç */
            .context-menu {
                max-width: 250px;
            }
            
            /* Ê∏©Â∫¶ÊªëÂùóÈÄÇÈÖç */
            .temperature-slider {
                max-width: 90%;
            }
        }

        /* Á°Æ‰øùÁßªÂä®ÂØºËà™Ê†èÈªòËÆ§ÊòØÈöêËóèÁöÑ */
        .mobile-navbar {
            display: none;
        }

        /* ÁßªÂä®Á´ØÂìçÂ∫îÂºèÈÄÇÈÖç */
        @media (max-width: 768px) {
            /* ÊòæÁ§∫ÁßªÂä®ÂØºËà™Ê†è */
            .mobile-navbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 15px;
                background: var(--bg-gradient);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 900;
            }
            
            /* ÂÖ∂‰ªñÁßªÂä®Á´ØÊ†∑Âºè‰øùÊåÅ‰∏çÂèò */
        }
    </style>
    <!-- Âú®headÊ†áÁ≠æ‰∏≠Ê∑ªÂä†marked.jsÂ∫ìÔºåÊîæÂú®ÂÖ∂‰ªñscriptÊ†áÁ≠æ‰πãÂâç -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
</head>
<body>
    <!-- Ê∑ªÂä†‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆÂà∞bodyÊú´Â∞æÔºåÂú®ËÑöÊú¨Ââç -->
    <div class="theme-toggle" id="themeToggleBtn">
        <svg id="lightIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <svg id="darkIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>

    <div class="container">
        <!-- Â∑¶‰æßËÅäÂ§©ÂàóË°® -->
        <div class="chat-list glass">
            <!-- Âú®chat-list-header‰∏ãÊ∑ªÂä†ÊêúÁ¥¢Ê†è -->
            <div class="chat-list-header">
                <div class="chat-list-title">AI Chat</div>
                <div class="new-chat-btn" onclick="startNewChat()">Êñ∞ÂØπËØù</div>
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢ÂØπËØùÂéÜÂè≤..." />
                <button id="searchBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="chat-item active">
                <span class="chat-icon">üí¨</span>
                <span class="chat-title">Êñ∞ÂØπËØù</span>
            </div>
        </div>

        <!-- ‰∏ªËÅäÂ§©Âå∫Âüü -->
        <div class="main-content">
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai-message">
                        <div class="message-header">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="#4a90e2" stroke-width="2"/>
                                <path d="M12 7V12L15 15" stroke="#4a90e2" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            DeepSeek AI
                        </div>
                        ÊÇ®Â•ΩÔºÅÊàëÊòØDeepSeek AIÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÔºü
                        <div class="message-time">‰ªäÂ§© 10:00</div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-controls">
                        <div class="chat-settings">
                            <div class="toggle-container">
                                <span class="toggle-label">Ê®°Âûã: <span id="modelLabel">R1 (Reasoner)</span></span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="deepThinkToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="temperature-container">
                                <span class="temperature-label">Ê∏©Â∫¶</span>
                                <input type="range" min="0" max="1" step="0.1" value="0.7" class="temperature-slider" id="temperatureSlider">
                                <span class="temperature-value" id="temperatureValue">0.7</span>
                            </div>
                            
                            <!-- Ê∑ªÂä†ËÆæÁΩÆÊåâÈíÆ -->
                            <div class="settings-btn" id="settingsBtn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        
                        <div class="toggle-container">
                            <span class="toggle-label">ÊòæÁ§∫ÊÄùËÄÉËøáÁ®ã</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showThinkingToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="chat-input-wrapper">
                    <input type="text" id="chatInput" placeholder="ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢ò...">
                        <button id="sendButton" onclick="sendMessage()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Âè≥ÈîÆËèúÂçï -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" id="menuRename">
            <div class="context-menu-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>ÈáçÂëΩÂêç</span>
        </div>
        <div class="context-menu-item" id="menuDuplicate">
            <div class="context-menu-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Â§çÂà∂ÂØπËØù</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" id="menuExport">
            <div class="context-menu-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="7 10 12 15 17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>ÂØºÂá∫ÂØπËØù</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" id="menuDelete">
            <div class="context-menu-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span>Âà†Èô§ÂØπËØù</span>
        </div>
    </div>

    <!-- ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="settingsModal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h2>ËÆæÁΩÆ</h2>
                <button class="close-btn" id="closeSettingsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>API ËÆæÁΩÆ</h3>
                    <div class="settings-item">
                        <label for="apiProvider">API Êèê‰æõÂïÜ</label>
                        <select id="apiProvider">
                            <option value="deepseek">DeepSeek</option>
                            <option value="openai">OpenAI</option>
                            <option value="gemini">Google Gemini</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label for="apiKey">API ÂØÜÈí•</label>
                        <div class="api-key-input">
                            <input type="password" id="apiKey" placeholder="ËæìÂÖ•ÊÇ®ÁöÑAPIÂØÜÈí•">
                            <button id="toggleApiKey" type="button">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section model-section" id="deepseekModels">
                    <h3>DeepSeek Ê®°Âûã</h3>
                    <div class="settings-item">
                        <label for="deepseekModel">Ê®°Âûã</label>
                        <select id="deepseekModel">
                            <option value="deepseek-chat">DeepSeek Chat</option>
                            <option value="deepseek-reasoner">DeepSeek Reasoner</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section model-section" id="openaiModels" style="display: none;">
                    <h3>OpenAI Ê®°Âûã</h3>
                    <div class="settings-item">
                        <label for="openaiModel">Ê®°Âûã</label>
                        <select id="openaiModel">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label for="openaiEndpoint">API ÁªàÁ´Ø</label>
                        <input type="text" id="openaiEndpoint" value="https://api.openai.com/v1/chat/completions" placeholder="OpenAI API ÁªàÁ´Ø">
                    </div>
                </div>
                
                <div class="settings-section model-section" id="geminiModels" style="display: none;">
                    <h3>Google Gemini Ê®°Âûã</h3>
                    <div class="settings-item">
                        <label for="geminiModel">Ê®°Âûã</label>
                        <select id="geminiModel">
                            <option value="gemini-pro">Gemini Pro</option>
                            <option value="gemini-ultra">Gemini Ultra</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label for="geminiEndpoint">API ÁªàÁ´Ø</label>
                        <input type="text" id="geminiEndpoint" value="https://generativelanguage.googleapis.com/v1beta/models/" placeholder="Gemini API ÁªàÁ´Ø">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>ÁïåÈù¢ËÆæÁΩÆ</h3>
                    <div class="settings-item">
                        <label for="uiTheme">ÁïåÈù¢‰∏ªÈ¢ò</label>
                        <select id="uiTheme">
                            <option value="auto">Ëá™Âä® (Ë∑üÈöèÁ≥ªÁªü)</option>
                            <option value="light">ÊµÖËâ≤</option>
                            <option value="dark">Ê∑±Ëâ≤</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" id="resetSettingsBtn">ÈáçÁΩÆËÆæÁΩÆ</button>
                <button class="btn primary" id="saveSettingsBtn">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // Ê∑ªÂä†APIÂíåÊ®°ÂûãÈÖçÁΩÆÂèòÈáè
        let apiConfig = {
            provider: 'deepseek',
            key: '', // Â∑≤ÁªèËÆæÁΩÆ‰∏∫Á©∫
            models: {
                deepseek: {
                    current: 'deepseek-reasoner',
                    endpoint: 'https://api.deepseek.com/v1/chat/completions'
                },
                openai: {
                    current: 'gpt-3.5-turbo',
                    endpoint: 'https://api.openai.com/v1/chat/completions'
                },
                gemini: {
                    current: 'gemini-pro',
                    endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/'
                }
            },
            uiTheme: 'auto'
        };

        // ËÅäÂ§©ËÆ∞ÂΩï
        let chatHistory = [];
        let currentChatId = 'chat-' + Date.now();
        let isWaitingForResponse = false;

        // Ê∑ªÂä†Âè≥ÈîÆËèúÂçïÁõ∏ÂÖ≥ÂèòÈáè
        let activeContextMenuChatId = null;
        const contextMenu = document.getElementById('contextMenu');

        // ÂàùÂßãÂåñÈ°µÈù¢
        document.addEventListener('DOMContentLoaded', () => {
            loadChatHistory();
            document.getElementById('chatInput').focus();
            
            // ÂàùÂßãÂåñÊ∏©Â∫¶ÊªëÂùó
            const temperatureSlider = document.getElementById('temperatureSlider');
            const temperatureValue = document.getElementById('temperatureValue');
            
            temperatureSlider.addEventListener('input', function() {
                temperatureValue.textContent = this.value;
            });
            
            // Ê∑ªÂä†Ê®°ÂûãÂàáÊç¢‰∫ã‰ª∂
            const deepThinkToggle = document.getElementById('deepThinkToggle');
            const modelLabel = document.getElementById('modelLabel');
            
            deepThinkToggle.addEventListener('change', function() {
                if (this.checked) {
                    modelLabel.textContent = 'R1 (Reasoner)';
                } else {
                    modelLabel.textContent = 'V3 (Chat)';
                }
            });

            // Âä†ËΩΩ‰øùÂ≠òÁöÑËÆæÁΩÆ
            loadSettings();
            
            // ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsModal = document.getElementById('settingsModal');
            const closeSettingsBtn = document.getElementById('closeSettingsBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            const resetSettingsBtn = document.getElementById('resetSettingsBtn');
            const toggleApiKeyBtn = document.getElementById('toggleApiKey');
            const apiKeyInput = document.getElementById('apiKey');
            const apiProviderSelect = document.getElementById('apiProvider');
            
            // ÊâìÂºÄËÆæÁΩÆ
            settingsBtn.addEventListener('click', () => {
                openSettingsModal();
            });
            
            // ÂÖ≥Èó≠ËÆæÁΩÆ
            closeSettingsBtn.addEventListener('click', () => {
                settingsModal.classList.remove('show');
            });
            
            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.classList.remove('show');
                }
            });
            
            // ÂàáÊç¢APIÂØÜÈí•ÂèØËßÅÊÄß
            toggleApiKeyBtn.addEventListener('click', () => {
                if (apiKeyInput.type === 'password') {
                    apiKeyInput.type = 'text';
                    toggleApiKeyBtn.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <line x1="2" y1="2" x2="22" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    `;
                } else {
                    apiKeyInput.type = 'password';
                    toggleApiKeyBtn.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    `;
                }
            });
            
            // ÂàáÊç¢APIÊèê‰æõÂïÜ
            apiProviderSelect.addEventListener('change', () => {
                updateModelSections(apiProviderSelect.value);
            });
            
            // ‰øùÂ≠òËÆæÁΩÆ
            saveSettingsBtn.addEventListener('click', () => {
                saveApiSettings();
                settingsModal.classList.remove('show');
            });
            
            // ÈáçÁΩÆËÆæÁΩÆ
            resetSettingsBtn.addEventListener('click', () => {
                resetSettings();
            });

            // Â∫îÁî®‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
            setTheme(apiConfig.uiTheme || 'auto');
            
            // ÁõëÂê¨Á≥ªÁªü‰∏ªÈ¢òÂèòÂåñÔºà‰ªÖÂú®autoÊ®°Âºè‰∏ãÔºâ
            if (window.matchMedia) {
                const colorSchemeQuery = window.matchMedia('(prefers-color-scheme: dark)');
                colorSchemeQuery.addEventListener('change', (e) => {
                    if (apiConfig.uiTheme === 'auto') {
                        setTheme('auto');
                    }
                });
            }
            
            // ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ‰∫ã‰ª∂
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            themeToggleBtn.addEventListener('click', () => {
                // Âæ™ÁéØÂàáÊç¢‰∏ªÈ¢òÔºöauto -> light -> dark -> auto
                const currentTheme = apiConfig.uiTheme || 'auto';
                switch (currentTheme) {
                    case 'auto':
                        setTheme('light');
                        showToast('Â∑≤ÂàáÊç¢Âà∞ÊµÖËâ≤‰∏ªÈ¢ò');
                        break;
                    case 'light':
                        setTheme('dark');
                        showToast('Â∑≤ÂàáÊç¢Âà∞Ê∑±Ëâ≤‰∏ªÈ¢ò');
                        break;
                    case 'dark':
                        setTheme('auto');
                        showToast('Â∑≤ÂàáÊç¢Âà∞Ëá™Âä®‰∏ªÈ¢òÔºàË∑üÈöèÁ≥ªÁªüÔºâ');
                        break;
                }
            });

            // ÂàùÂßãÂåñÂè≥ÈîÆËèúÂçï‰∫ã‰ª∂
            initContextMenuEvents();

            // ÊêúÁ¥¢ËÅäÂ§©ËÆ∞ÂΩï
            initSearchFunction();
        });

        // ÊâìÂºÄËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÂπ∂Â°´ÂÖÖÂΩìÂâçËÆæÁΩÆ
        function openSettingsModal() {
            const settingsModal = document.getElementById('settingsModal');
            const apiKeyInput = document.getElementById('apiKey');
            const apiProviderSelect = document.getElementById('apiProvider');
            const deepseekModelSelect = document.getElementById('deepseekModel');
            const openaiModelSelect = document.getElementById('openaiModel');
            const geminiModelSelect = document.getElementById('geminiModel');
            const openaiEndpointInput = document.getElementById('openaiEndpoint');
            const geminiEndpointInput = document.getElementById('geminiEndpoint');
            const uiThemeSelect = document.getElementById('uiTheme');
            
            // Â°´ÂÖÖÂΩìÂâçËÆæÁΩÆ
            apiKeyInput.value = apiConfig.key;
            apiProviderSelect.value = apiConfig.provider;
            deepseekModelSelect.value = apiConfig.models.deepseek.current;
            openaiModelSelect.value = apiConfig.models.openai.current;
            geminiModelSelect.value = apiConfig.models.gemini.current;
            openaiEndpointInput.value = apiConfig.models.openai.endpoint;
            geminiEndpointInput.value = apiConfig.models.gemini.endpoint;
            uiThemeSelect.value = apiConfig.uiTheme || 'auto';
            
            // ÊòæÁ§∫ÂØπÂ∫îÁöÑÊ®°ÂûãËÆæÁΩÆÂå∫Âüü
            updateModelSections(apiConfig.provider);
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            settingsModal.classList.add('show');
        }
        
        // Êõ¥Êñ∞Ê®°ÂûãÂå∫ÂüüÊòæÁ§∫
        function updateModelSections(provider) {
            const deepseekModels = document.getElementById('deepseekModels');
            const openaiModels = document.getElementById('openaiModels');
            const geminiModels = document.getElementById('geminiModels');
            
            // ÈöêËóèÊâÄÊúâÊ®°ÂûãÂå∫Âüü
            deepseekModels.style.display = 'none';
            openaiModels.style.display = 'none';
            geminiModels.style.display = 'none';
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊèê‰æõÂïÜÁöÑÊ®°ÂûãÂå∫Âüü
            switch (provider) {
                case 'deepseek':
                    deepseekModels.style.display = 'block';
                    break;
                case 'openai':
                    openaiModels.style.display = 'block';
                    break;
                case 'gemini':
                    geminiModels.style.display = 'block';
                    break;
            }
        }
        
        // ‰øùÂ≠òAPIËÆæÁΩÆ
        function saveApiSettings() {
            const apiKeyInput = document.getElementById('apiKey');
            const apiProviderSelect = document.getElementById('apiProvider');
            const deepseekModelSelect = document.getElementById('deepseekModel');
            const openaiModelSelect = document.getElementById('openaiModel');
            const geminiModelSelect = document.getElementById('geminiModel');
            const openaiEndpointInput = document.getElementById('openaiEndpoint');
            const geminiEndpointInput = document.getElementById('geminiEndpoint');
            const uiThemeSelect = document.getElementById('uiTheme');
            
            // Êõ¥Êñ∞ÈÖçÁΩÆ
            apiConfig.key = apiKeyInput.value;
            apiConfig.provider = apiProviderSelect.value;
            apiConfig.models.deepseek.current = deepseekModelSelect.value;
            apiConfig.models.openai.current = openaiModelSelect.value;
            apiConfig.models.gemini.current = geminiModelSelect.value;
            apiConfig.models.openai.endpoint = openaiEndpointInput.value;
            apiConfig.models.gemini.endpoint = geminiEndpointInput.value;
            apiConfig.uiTheme = uiThemeSelect.value;
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('apiConfig', JSON.stringify(apiConfig));
            
            // Êõ¥Êñ∞UI
            updateUIForProvider();
            
            // Â∫îÁî®‰∏ªÈ¢òËÆæÁΩÆ
            setTheme(apiConfig.uiTheme);
            
            // ÊòæÁ§∫‰øùÂ≠òÊàêÂäüÊ∂àÊÅØ
            showToast('ËÆæÁΩÆ‰øùÂ≠òÊàêÂäü');
        }
        
        // ÈáçÁΩÆËÆæÁΩÆ
        function resetSettings() {
            // ÈªòËÆ§ËÆæÁΩÆ
            apiConfig = {
                provider: 'deepseek',
                key: 'sk-446c8fb1e0db45d89c0d6c9fd4f959e8',
                models: {
                    deepseek: {
                        current: 'deepseek-reasoner',
                        endpoint: 'https://api.deepseek.com/v1/chat/completions'
                    },
                    openai: {
                        current: 'gpt-3.5-turbo',
                        endpoint: 'https://api.openai.com/v1/chat/completions'
                    },
                    gemini: {
                        current: 'gemini-pro',
                        endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/'
                    }
                },
                uiTheme: 'auto'
            };
            
            // Êõ¥Êñ∞ËÆæÁΩÆUI
            openSettingsModal();
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('apiConfig', JSON.stringify(apiConfig));
            
            // ÊòæÁ§∫ÈáçÁΩÆÊàêÂäüÊ∂àÊÅØ
            showToast('ËÆæÁΩÆÂ∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÂÄº');
        }
        
        // Âä†ËΩΩ‰øùÂ≠òÁöÑËÆæÁΩÆ
        function loadSettings() {
            const savedConfig = localStorage.getItem('apiConfig');
            if (savedConfig) {
                try {
                    const parsedConfig = JSON.parse(savedConfig);
                    apiConfig = { ...apiConfig, ...parsedConfig };
                    
                    // Á°Æ‰øùÊâÄÊúâÂøÖË¶ÅÁöÑÂ≠óÊÆµÈÉΩÂ≠òÂú®
                    if (!apiConfig.models) {
                        apiConfig.models = {
                            deepseek: {
                                current: 'deepseek-reasoner',
                                endpoint: 'https://api.deepseek.com/v1/chat/completions'
                            },
                            openai: {
                                current: 'gpt-3.5-turbo',
                                endpoint: 'https://api.openai.com/v1/chat/completions'
                            },
                            gemini: {
                                current: 'gemini-pro',
                                endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/'
                            }
                        };
                    }
                    
                    // Êõ¥Êñ∞UI
                    updateUIForProvider();
                } catch (e) {
                    console.error('Âä†ËΩΩËÆæÁΩÆÂá∫Èîô:', e);
                }
            }
        }
        
        // Ê†πÊçÆAPIÊèê‰æõÂïÜÊõ¥Êñ∞UI
        function updateUIForProvider() {
            const modelLabel = document.getElementById('modelLabel');
            const deepThinkToggle = document.getElementById('deepThinkToggle');
            
            // Ê†πÊçÆÂΩìÂâçÊèê‰æõÂïÜÂíåÊ®°ÂûãÊõ¥Êñ∞UI
            switch (apiConfig.provider) {
                case 'deepseek':
                    // Êõ¥Êñ∞ËÆæÁΩÆÊ†áÁ≠æ
                    if (apiConfig.models.deepseek.current === 'deepseek-reasoner') {
                        modelLabel.textContent = 'R1 (Reasoner)';
                        deepThinkToggle.checked = true;
                    } else {
                        modelLabel.textContent = 'V3 (Chat)';
                        deepThinkToggle.checked = false;
                    }
                    break;
                case 'openai':
                    modelLabel.textContent = apiConfig.models.openai.current;
                    // Á¶ÅÁî®ReasonerÁâπÂÆöÂäüËÉΩ
                    document.getElementById('showThinkingToggle').disabled = true;
                    break;
                case 'gemini':
                    modelLabel.textContent = apiConfig.models.gemini.current;
                    // Á¶ÅÁî®ReasonerÁâπÂÆöÂäüËÉΩ
                    document.getElementById('showThinkingToggle').disabled = true;
                    break;
            }
        }
        
        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
        function showToast(message, duration = 3000) {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®toastÂÖÉÁ¥†
            let toast = document.getElementById('toast');
            if (!toast) {
                // ÂàõÂª∫Êñ∞ÁöÑtoastÂÖÉÁ¥†
                toast = document.createElement('div');
                toast.id = 'toast';
                toast.className = 'toast';
                document.body.appendChild(toast);
            }
            
            // ËÆæÁΩÆÊ∂àÊÅØÂπ∂ÊòæÁ§∫
            toast.textContent = message;
            toast.classList.add('show');
            
            // ËÆæÁΩÆËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // ÂèëÈÄÅÊ∂àÊÅØÂáΩÊï∞‰øÆÊîπ
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (!message || isWaitingForResponse) return;

            // Ê£ÄÊü•ÊòØÂê¶ÊúâAPIÂØÜÈí•
            if (!apiConfig.key) {
                showToast('ËØ∑ÂÖàËÆæÁΩÆAPIÂØÜÈí•');
                addApiKeyButton(); // Á°Æ‰øùÊåâÈíÆÂèØËßÅ
                openSettingsModal(); // Áõ¥Êé•ÊâìÂºÄËÆæÁΩÆÈ°µÈù¢
                return;
            }

            // Ëé∑ÂèñÂΩìÂâçËÆæÁΩÆ
            const deepThinking = document.getElementById('deepThinkToggle').checked;
            const showThinking = document.getElementById('showThinkingToggle').checked;
            const temperature = parseFloat(document.getElementById('temperatureSlider').value);

            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            const timestamp = new Date();
            addMessage(message, 'user', timestamp);
            input.value = '';
            
            // Êõ¥Êñ∞ËÅäÂ§©ÂéÜÂè≤
            chatHistory.push({
                role: 'user',
                content: message,
                timestamp: timestamp.toISOString()
            });

            // ÊòæÁ§∫loadingÁä∂ÊÄÅ
            isWaitingForResponse = true;
            sendBtn.disabled = true;
            showTypingIndicator();

            try {
                let apiEndpoint, modelName, requestBody, headers;
                
                // Ê†πÊçÆÂΩìÂâçÊèê‰æõÂïÜËÆæÁΩÆAPIÂèÇÊï∞
                switch (apiConfig.provider) {
                    case 'deepseek':
                        apiEndpoint = apiConfig.models.deepseek.endpoint;
                        modelName = deepThinking ? 'deepseek-reasoner' : 'deepseek-chat';
                        requestBody = {
                            model: modelName,
                            messages: formatMessagesForAPI(),
                            temperature: temperature
                        };
                        
                        // ÊµÅÂºèÂìçÂ∫îËÆæÁΩÆ
                        if (showThinking) {
                            requestBody.stream = true;
                        }
                        
                        headers = {
                        'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiConfig.key}`
                        };
                        break;
                        
                    case 'openai':
                        apiEndpoint = apiConfig.models.openai.endpoint;
                        modelName = apiConfig.models.openai.current;
                        requestBody = {
                            model: modelName,
                            messages: formatMessagesForAPI(),
                            temperature: temperature
                        };
                        
                        // ÊµÅÂºèÂìçÂ∫îËÆæÁΩÆ
                        if (showThinking) {
                            requestBody.stream = true;
                        }
                        
                        headers = {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiConfig.key}`
                        };
                        break;
                        
                    case 'gemini':
                        modelName = apiConfig.models.gemini.current;
                        apiEndpoint = `${apiConfig.models.gemini.endpoint}${modelName}:generateContent`;
                        
                        // Gemini API‰ΩøÁî®‰∏çÂêåÁöÑËØ∑Ê±ÇÊ†ºÂºè
                        requestBody = {
                            contents: formatMessagesForAPI().map(msg => ({
                                role: msg.role === 'user' ? 'user' : 'model',
                                parts: [{ text: msg.content }]
                            })),
                            generationConfig: {
                                temperature: temperature
                            }
                        };
                        
                        headers = {
                            'Content-Type': 'application/json',
                            'x-goog-api-key': apiConfig.key
                        };
                        break;
                        
                    default:
                        throw new Error('‰∏çÊîØÊåÅÁöÑAPIÊèê‰æõÂïÜ');
                }
                
                console.log(`‰ΩøÁî®${apiConfig.provider}ÁöÑ${modelName}Ê®°ÂûãÂèëÈÄÅËØ∑Ê±Ç`);
                console.log("ËØ∑Ê±Ç‰Ωì:", requestBody);
                
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestBody)
                });

                hideTypingIndicator();

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error("APIÈîôËØØËØ¶ÊÉÖ:", errorData);
                    throw new Error(`APIËØ∑Ê±ÇÂ§±Ë¥•: ${response.status} - ${errorData.error?.message || 'Êú™Áü•ÈîôËØØ'}`);
                }

                let aiResponse = '';

                // Â§ÑÁêÜÊµÅÂºèÂìçÂ∫î
                if (showThinking && response.body) {
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder("utf-8");
                    
                    // ÂàõÂª∫ÊÄùËÄÉËøáÁ®ãÂÖÉÁ¥† - ‰ΩøÁî®Ê®°ÊãüÊÄùËÄÉËøáÁ®ã
                    const thinkingTimestamp = new Date();
                    const thinkingId = 'thinking-' + Date.now();
                    
                    // ‰ªÖÂΩì‰ΩøÁî® Reasoner Ê®°ÂûãÊó∂ÊòæÁ§∫ÊÄùËÄÉËøáÁ®ã
                    if (deepThinking) {
                        addThinkingElement(thinkingId, thinkingTimestamp);
                        updateThinkingElement(thinkingId, deepThinking ? 
                            "R1 Ê®°ÂûãÊÄùËÄÉ‰∏≠...\nÂàÜÊûêÈóÆÈ¢ò..." : 
                            "V3 Ê®°ÂûãÁîüÊàêÂõûÂ§ç...");
                    }
                    
                    let buffer = '';
                    
                    while (true) {
                        const { done, value } = await reader.read();
                        
                        if (done) {
                            break;
                        }
                        
                        // Ëß£ÊûêÂìçÂ∫îÂùó
                        const chunk = decoder.decode(value, { stream: true });
                        buffer += chunk;
                        
                        // Â∞ùËØïËß£ÊûêÂÆåÊï¥ÁöÑJSONÂØπË±°
                        const lines = buffer.split('\n');
                        buffer = lines.pop() || ''; // ÊúÄÂêé‰∏ÄË°åÂèØËÉΩ‰∏çÂÆåÊï¥
                        
                        for (const line of lines) {
                            if (line.trim() === '') continue;
                            
                            if (line.startsWith('data:')) {
                                const data = line.slice(5).trim();
                                
                                try {
                                    if (data === '[DONE]') {
                                        continue;
                                    }
                                    
                                    const parsedData = JSON.parse(data);
                                    
                                    // Ê£ÄÊü•ÊòØÂê¶ÊúâÊÄùËÄÉËøáÁ®ã (ÈíàÂØπ reasoner Ê®°Âûã)
                                    if (parsedData.thinking && deepThinking) {
                                        updateThinkingElement(thinkingId, parsedData.thinking);
                                    }
                                    
                                    // ÊµÅÂºèÂìçÂ∫îÂ§ÑÁêÜ
                                    if (parsedData.choices && parsedData.choices[0].delta) {
                                        const content = parsedData.choices[0].delta.content || '';
                                        aiResponse += content;
                                        
                                        // Â¶ÇÊûúÊòØ Reasoner Ê®°ÂûãÔºåÊõ¥Êñ∞ÊÄùËÄÉËøáÁ®ã
                                        if (deepThinking && aiResponse.length % 20 === 0) {
                                            updateThinkingElement(thinkingId, 
                                                "ÂàÜÊûêÈóÆÈ¢ò‰∏≠...\nÊ≠£Âú®ÊÄùËÄÉ...\n\nÁîüÊàêÂõûÁ≠î: " + aiResponse);
                                        }
                                    }
                                } catch (e) {
                                    console.error('Ëß£ÊûêÂìçÂ∫îÊó∂Âá∫Èîô:', e, data);
                                }
                            }
                        }
                    }
                    
                    // Á≠âÂæÖ‰∏ÄÂ∞èÊÆµÊó∂Èó¥ÂêéÁßªÈô§ÊÄùËÄÉÂÖÉÁ¥†ÔºåÊòæÁ§∫ÂÆåÊï¥ÂõûÂ§ç
                    if (deepThinking) {
                        setTimeout(() => {
                            if (document.getElementById(thinkingId)) {
                                document.getElementById(thinkingId).remove();
                            }
                
                // Ê∑ªÂä†AIÂõûÂ§ç
                            addCompletedResponse(aiResponse);
                        }, 1500);
                    } else {
                        // ÂØπ‰∫éV3Ê®°ÂûãÔºåÁõ¥Êé•ÊòæÁ§∫ÂõûÂ§ç
                        addCompletedResponse(aiResponse);
                    }
                    
                } else {
                    // Â§ÑÁêÜÂ∏∏ËßÑÂìçÂ∫î
                const data = await response.json();
                    aiResponse = data.choices[0].message.content;
                
                // Ê∑ªÂä†AIÂõûÂ§ç
                    addCompletedResponse(aiResponse);
                }

            } catch (error) {
                hideTypingIndicator();
                addMessage(`ÂæàÊä±Ê≠âÔºåÂèëÁîü‰∫Ü‰∏Ä‰∏™ÈîôËØØ: ${error.message}`, 'ai', new Date());
                console.error('APIÈîôËØØ:', error);
            } finally {
                isWaitingForResponse = false;
                sendBtn.disabled = false;
            }
        }

        // ‰øÆÊîπÊ∑ªÂä†Ê∂àÊÅØÁöÑÂáΩÊï∞ÔºåÊîØÊåÅMarkdown
        function addMessage(content, type, timestamp) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            // Ê∑ªÂä†ÂèëÈÄÅËÄÖ‰ø°ÊÅØ
            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            
            if (type === 'user') {
                headerDiv.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                        <path d="M8 14.5C8 14.5 9.5 16.5 12 16.5C14.5 16.5 16 14.5 16 14.5" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="9" cy="10" r="1.5" fill="white"/>
                        <circle cx="15" cy="10" r="1.5" fill="white"/>
                    </svg>
                    Êàë
                `;
            } else {
                headerDiv.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="#4a90e2" stroke-width="2"/>
                        <path d="M12 7V12L15 15" stroke="#4a90e2" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    DeepSeek AI
                `;
            }
            
            messageDiv.appendChild(headerDiv);
            
            // Ê∑ªÂä†Ê∂àÊÅØÂÜÖÂÆπ - ÊîØÊåÅMarkdown
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (type === 'ai') {
                // ‰∏∫AIÊ∂àÊÅØÂ∫îÁî®MarkdownËß£Êûê
                const processedContent = processMarkdownContent(content);
                contentDiv.innerHTML = processedContent;
            } else {
                // Áî®Êà∑Ê∂àÊÅØ‰ªÖÊîØÊåÅÂü∫Á°ÄÊñáÊú¨Ê†ºÂºè
                contentDiv.style.whiteSpace = 'pre-wrap';
                contentDiv.textContent = content;
            }
            
            messageDiv.appendChild(contentDiv);
            
            // Ê∑ªÂä†Êó∂Èó¥Êà≥
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = formatTime(timestamp);
            messageDiv.appendChild(timeDiv);
            
            messagesDiv.appendChild(messageDiv);
            scrollToBottom();
        }

        // ‰øÆÊîπprocessMarkdownContentÂáΩÊï∞Ôºå‰∏∫‰ª£Á†ÅÂùóÊ∑ªÂä†Â§çÂà∂ÊåâÈíÆ
        function processMarkdownContent(content) {
            // ÈÖçÁΩÆmarkedÈÄâÈ°π
            marked.setOptions({
                breaks: true,
                gfm: true,
                headerIds: false,
                mangle: false,
                sanitize: false,
                smartLists: true,
                smartypants: true,
                highlight: function(code, lang) {
                    return code;
                }
            });
            
            // Ëß£Êûê‰∏∫Markdown
            let htmlContent = marked.parse(content);
            
            // ‰∏∫ÊâÄÊúâ‰ª£Á†ÅÂùóÊ∑ªÂä†Â§çÂà∂ÊåâÈíÆ
            // ‰ΩøÁî®DOMÊìç‰ΩúËÄå‰∏çÊòØÁõ¥Êé•Â≠óÁ¨¶‰∏≤ÊõøÊç¢Ôºå‰ª•‰æøÊõ¥ÂáÜÁ°ÆÂú∞Â§ÑÁêÜ‰ª£Á†ÅÂùó
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            // Êü•ÊâæÊâÄÊúâpre>codeÂÖÉÁ¥†
            const codeBlocks = tempDiv.querySelectorAll('pre > code');
            codeBlocks.forEach((codeBlock, index) => {
                // Ëé∑Âèñ‰ª£Á†ÅÂÜÖÂÆπ
                const code = codeBlock.textContent;
                
                // ÂàõÂª∫ÂåÖË£ÖÂÆπÂô®‰ΩøÊåâÈíÆÂÆö‰ΩçÊõ¥ÂÆπÊòì
                const wrapper = document.createElement('div');
                wrapper.className = 'code-block-wrapper';
                
                // ÂàõÂª∫Â§çÂà∂ÊåâÈíÆ
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-code-button';
                copyButton.setAttribute('data-code-index', index);
                copyButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                    </svg>
                `;
                
                // Ëé∑Âèñ‰ª£Á†ÅÂùóÁà∂ÂÖÉÁ¥†(pre)
                const preElement = codeBlock.parentNode;
                
                // ÂàõÂª∫ÂåÖË£ÖÂÆπÂô®Âπ∂Ê∑ªÂä†Â§çÂà∂ÊåâÈíÆÂíåÂéüpreÂÖÉÁ¥†
                wrapper.appendChild(copyButton);
                
                // Â∞ÜpreÂÖÉÁ¥†ÊõøÊç¢‰∏∫ÂåÖË£ÖÂÆπÂô®
                preElement.parentNode.insertBefore(wrapper, preElement);
                wrapper.appendChild(preElement);
            });
            
            // ËøîÂõû‰øÆÊîπÂêéÁöÑHTML
            return tempDiv.innerHTML;
        }

        // Ê∑ªÂä†Â§çÂà∂‰ª£Á†ÅÂäüËÉΩ
        document.addEventListener('click', function(e) {
            // Ê£ÄÊü•ÊòØÂê¶ÁÇπÂáª‰∫ÜÂ§çÂà∂ÊåâÈíÆ
            if (e.target.closest('.copy-code-button')) {
                const button = e.target.closest('.copy-code-button');
                // Ëé∑ÂèñÂØπÂ∫îÁöÑ‰ª£Á†ÅÂùó
                const codeBlock = button.closest('.code-block-wrapper').querySelector('pre > code');
                const codeText = codeBlock.textContent;
                
                // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                navigator.clipboard.writeText(codeText).then(() => {
                    // ÊòæÁ§∫ÊàêÂäüÂèçÈ¶à
                    button.classList.add('copied');
                    button.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    `;
                    
                    // 2ÁßíÂêéÊÅ¢Â§çÂéüÂßãÂõæÊ†á
                    setTimeout(() => {
                        button.classList.remove('copied');
                        button.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                            </svg>
                        `;
                    }, 2000);
                }).catch(err => {
                    console.error('Êó†Ê≥ïÂ§çÂà∂ÊñáÊú¨: ', err);
                    // ÊòæÁ§∫ÈîôËØØÂèçÈ¶à
                    showToast('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                });
            }
        });

        // Âú®addCompletedResponseÂáΩÊï∞‰∏≠Ê∑ªÂä†markdownÊîØÊåÅ
        function addCompletedResponse(response) {
            const aiTimestamp = new Date();
            addMessage(response, 'ai', aiTimestamp);
            
            // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
            chatHistory.push({
                role: 'assistant',
                content: response,
                timestamp: aiTimestamp.toISOString()
            });
            
            saveChatHistory();
            updateChatList();
        }

        function addThinkingElement(id, timestamp) {
            const messagesDiv = document.getElementById('chatMessages');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'message ai-thinking';
            thinkingDiv.id = id;
            
            // Ê∑ªÂä†Â§¥ÈÉ®‰ø°ÊÅØ
            const thinkingHeader = document.createElement('div');
            thinkingHeader.className = 'thinking-header';
            thinkingHeader.innerHTML = `
                <div>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke="#4a90e2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ÊÄùËÄÉËøáÁ®ã
                </div>
                <div>${formatTime(timestamp)}</div>
            `;
            thinkingDiv.appendChild(thinkingHeader);
            
            // Ê∑ªÂä†ÊÄùËÄÉÂÜÖÂÆπÂÆπÂô®
            const contentDiv = document.createElement('div');
            contentDiv.style.whiteSpace = 'pre-wrap';
            contentDiv.textContent = 'ÊÄùËÄÉ‰∏≠...';
            thinkingDiv.appendChild(contentDiv);
            
            messagesDiv.appendChild(thinkingDiv);
            scrollToBottom();
        }
        
        function updateThinkingElement(id, content) {
            const thinkingDiv = document.getElementById(id);
            if (thinkingDiv) {
                const contentDiv = thinkingDiv.querySelector('div:nth-child(2)');
                if (contentDiv) {
                    contentDiv.textContent = content;
                    scrollToBottom();
                }
            }
        }

        function formatTime(date) {
            const now = new Date();
            const isToday = now.toDateString() === date.toDateString();
            
            if (isToday) {
                return '‰ªäÂ§© ' + date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            } else {
                return date.toLocaleDateString('zh-CN') + ' ' + 
                       date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            }
        }

        function formatMessagesForAPI() {
            // Ëé∑ÂèñÊúÄËøëÁöÑÂØπËØù
            let messages = chatHistory.slice(-20);
            const deepThinking = document.getElementById('deepThinkToggle').checked;
            
            // Â¶ÇÊûú‰ΩøÁî® Reasoner Ê®°ÂûãÔºåÈúÄË¶ÅÁ°Æ‰øù‰∫§ÊõøÁöÑÊ∂àÊÅØÂ∫èÂàó
            if (deepThinking) {
                // Á°Æ‰øùÁ¨¨‰∏ÄÊù°Ê∂àÊÅØÊòØÁî®Êà∑Ê∂àÊÅØ
                while (messages.length > 0 && messages[0].role !== 'user') {
                    messages.shift();
                }
                
                // Â¶ÇÊûúÊ≤°ÊúâÁî®Êà∑Ê∂àÊÅØÔºåËøîÂõûÁ©∫Êï∞ÁªÑ
                if (messages.length === 0) {
                    return [];
                }
                
                // Â§ÑÁêÜËøûÁª≠ÁöÑÁõ∏ÂêåËßíËâ≤Ê∂àÊÅØÔºåÁ°Æ‰øù‰∫§ÊõøÂá∫Áé∞
                const cleanedMessages = [];
                let lastRole = null;
                
                for (const msg of messages) {
                    // Â¶ÇÊûúÂΩìÂâçÊ∂àÊÅØËßíËâ≤‰∏é‰∏ä‰∏Ä‰∏™‰∏çÂêåÔºåÊàñËÄÖÊòØÁ¨¨‰∏ÄÊù°Ê∂àÊÅØÔºåÂàôÊ∑ªÂä†
                    if (msg.role !== lastRole) {
                        cleanedMessages.push(msg);
                        lastRole = msg.role;
                    } else {
                        // Â¶ÇÊûúËøûÁª≠Áõ∏ÂêåËßíËâ≤ÔºåÊõøÊç¢‰∏ä‰∏ÄÊù°Ê∂àÊÅØ
                        cleanedMessages[cleanedMessages.length - 1] = msg;
                    }
                }
                
                // Á°Æ‰øùÊï¥‰∏™ÂØπËØùÂéÜÂè≤ÊòØ‰∫§ÊõøÁöÑ user -> assistant -> user -> assistant...
                const finalMessages = [];
                let expectedRole = 'user'; // ÊúüÊúõÁöÑÁ¨¨‰∏Ä‰∏™ËßíËâ≤
                
                for (const msg of cleanedMessages) {
                    if (msg.role === expectedRole) {
                        finalMessages.push(msg);
                        // ÂàáÊç¢‰∏ã‰∏Ä‰∏™ÊúüÊúõËßíËâ≤
                        expectedRole = expectedRole === 'user' ? 'assistant' : 'user';
                    } else {
                        // ËßíËâ≤‰∏çÁ¨¶ÂêàÈ¢ÑÊúüÔºåÂèëÁîü‰∫ÜËøûÁª≠Áõ∏ÂêåËßíËâ≤ÁöÑÊÉÖÂÜµ
                        // Ë∑≥ËøáÂà∞‰∏ã‰∏Ä‰∏™ÊúüÊúõËßíËâ≤
                        if (finalMessages.length > 0) {
                            finalMessages.push(msg);
                            expectedRole = 'user'; // ÈáçÁΩÆÊúüÊúõ
                        }
                    }
                }
                
                console.log("ÂéüÂßãÊ∂àÊÅØ:", messages.map(m => m.role).join(', '));
                console.log("Â§ÑÁêÜÂêéÊ∂àÊÅØ:", finalMessages.map(m => m.role).join(', '));
                
                // ËΩ¨Êç¢‰∏∫APIÊ†ºÂºè
                return finalMessages.map(msg => ({
                    role: msg.role,
                    content: msg.content
                }));
            } else {
                // ÂØπ‰∫é Chat Ê®°ÂûãÔºå‰∏çÈúÄË¶Å‰∏•Ê†º‰∫§ÊõøÔºåÁõ¥Êé•ËøîÂõûÊâÄÊúâÊ∂àÊÅØ
                return messages.map(msg => ({
                    role: msg.role,
                    content: msg.content
                }));
            }
        }

        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot';
                typingDiv.appendChild(dot);
            }
            
            messagesDiv.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function scrollToBottom() {
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function saveChatHistory() {
            // Â∞ÜÂΩìÂâçÂØπËØù‰øùÂ≠òÂà∞localStorage
            const chatData = {
                id: currentChatId,
                title: getChatTitle(),
                messages: chatHistory,
                lastUpdated: new Date().toISOString()
            };
            
            // Ëé∑ÂèñÊâÄÊúâÂØπËØù
            let allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
            
            // Êõ¥Êñ∞ÊàñÊ∑ªÂä†ÂΩìÂâçÂØπËØù
            const existingChatIndex = allChats.findIndex(chat => chat.id === currentChatId);
            if (existingChatIndex >= 0) {
                allChats[existingChatIndex] = chatData;
            } else {
                allChats.push(chatData);
            }
            
            // ‰øùÂ≠òÂõûlocalStorage
            localStorage.setItem('allChats', JSON.stringify(allChats));
            localStorage.setItem('currentChatId', currentChatId);
        }

        function getChatTitle() {
            // ‰ΩøÁî®Á¨¨‰∏ÄÊù°Áî®Êà∑Ê∂àÊÅØ‰Ωú‰∏∫Ê†áÈ¢ò
            const firstUserMessage = chatHistory.find(msg => msg.role === 'user');
            if (firstUserMessage) {
                // Êà™ÂèñÂâç20‰∏™Â≠óÁ¨¶‰Ωú‰∏∫Ê†áÈ¢ò
                let title = firstUserMessage.content.substring(0, 20);
                if (firstUserMessage.content.length > 20) {
                    title += '...';
                }
                return title;
            }
            return 'Êñ∞ÂØπËØù';
        }

        function loadChatHistory() {
            // ‰ªélocalStorageÂä†ËΩΩÂØπËØùÂéÜÂè≤
            const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
            currentChatId = localStorage.getItem('currentChatId');
            
            // Â¶ÇÊûúÊ≤°ÊúâÂΩìÂâçÂØπËØùÊàñÂΩìÂâçÂØπËØù‰∏çÂ≠òÂú®ÔºåÂàõÂª∫Êñ∞ÂØπËØù
            if (!currentChatId || !allChats.find(chat => chat.id === currentChatId)) {
                startNewChat();
                return;
            }
            
            // Âä†ËΩΩÂΩìÂâçÂØπËØù
            const currentChat = allChats.find(chat => chat.id === currentChatId);
            chatHistory = currentChat.messages || [];
            
            // Ê∏≤ÊüìÊ∂àÊÅØ
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.innerHTML = ''; // Ê∏ÖÁ©∫Áé∞ÊúâÊ∂àÊÅØ
            
            // Â¶ÇÊûúÂéÜÂè≤‰∏∫Á©∫ÔºåÊòæÁ§∫Ê¨¢ËøéÊ∂àÊÅØ
            if (chatHistory.length === 0) {
                displayWelcomeMessage();
            } else {
                // ÊòæÁ§∫ÂéÜÂè≤Ê∂àÊÅØ
                chatHistory.forEach(msg => {
                    const type = msg.role === 'user' ? 'user' : 'ai';
                    addMessage(msg.content, type, new Date(msg.timestamp));
                });
            }
            
            // Êõ¥Êñ∞ËÅäÂ§©ÂàóË°®
            updateChatList();
        }

        function updateChatList() {
            // Êõ¥Êñ∞‰æßËæπÊ†èÁöÑËÅäÂ§©ÂàóË°®
            const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
            const chatListDiv = document.querySelector('.chat-list');
            
            // ‰øùÁïôÂ§¥ÈÉ®
            const headerDiv = chatListDiv.querySelector('.chat-list-header');
            chatListDiv.innerHTML = '';
            chatListDiv.appendChild(headerDiv);
            
            // ÊåâÊúÄÂêéÊõ¥Êñ∞Êó∂Èó¥ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÈù¢Ôºâ
            allChats.sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated));
            
            // Ê∑ªÂä†ÊâÄÊúâÂØπËØù
            allChats.forEach(chat => {
                const chatItemDiv = document.createElement('div');
                chatItemDiv.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                chatItemDiv.dataset.chatId = chat.id;
                chatItemDiv.innerHTML = `
                    <span class="chat-icon">üí¨</span>
                    <span class="chat-title">${chat.title}</span>
                `;
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                chatItemDiv.addEventListener('click', () => loadChat(chat.id));
                
                // Ê∑ªÂä†Âè≥ÈîÆËèúÂçï‰∫ã‰ª∂
                chatItemDiv.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    showContextMenu(e, chat.id);
                });
                
                chatListDiv.appendChild(chatItemDiv);
            });
        }

        function loadChat(chatId) {
            // Âä†ËΩΩÁâπÂÆöÂØπËØù
            currentChatId = chatId;
            localStorage.setItem('currentChatId', chatId);
            loadChatHistory();
        }

        function startNewChat() {
            // ÂàõÂª∫Êñ∞ÂØπËØù
            currentChatId = 'chat-' + Date.now();
            chatHistory = [];
            
            // ÊòæÁ§∫Ê¨¢ËøéÊ∂àÊÅØÔºå‰ΩÜ‰∏çÂä†ÂÖ•Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
            displayWelcomeMessage();
            
            // ‰øùÂ≠òÊñ∞ÁöÑÁ©∫ÂØπËØù
            saveChatHistory();
            updateChatList();
            
            // ËÅöÁÑ¶ËæìÂÖ•Ê°Ü
            document.getElementById('chatInput').focus();
        }

        // ÂõûËΩ¶ÂèëÈÄÅÊ∂àÊÅØ
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ËæÖÂä©ÂáΩÊï∞ÔºöÊ∑ªÂä†ÂÆåÊï¥ÁöÑAIÂìçÂ∫î
        function addCompletedResponse(response) {
            const aiTimestamp = new Date();
            addMessage(response, 'ai', aiTimestamp);
            
            // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
            chatHistory.push({
                role: 'assistant',
                content: response,
                timestamp: aiTimestamp.toISOString()
            });
            
            saveChatHistory();
            updateChatList();
        }

        // Âú®UIÊòæÁ§∫Ê¨¢ËøéÊ∂àÊÅØÔºå‰ΩÜ‰∏çËÆ∞ÂΩïÂà∞ËÅäÂ§©ÂéÜÂè≤
        function displayWelcomeMessage() {
            const welcomeTimestamp = new Date();
            const messagesDiv = document.getElementById('chatMessages');
            
            // Ê∏ÖÁ©∫Ê∂àÊÅØÂå∫Âüü
            messagesDiv.innerHTML = '';
            
            // Ê∑ªÂä†Ê¨¢ËøéÊ∂àÊÅØÂà∞UI
            const messageText = apiConfig.key ? 
                'ÊÇ®Â•ΩÔºÅÊàëÊòØDeepSeek‰∫∫Â∑•Êô∫ËÉΩÂä©ÊâãÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÔºü' : 
                'ÊÇ®Â•ΩÔºÅÂú®ÂºÄÂßã‰ΩøÁî®DeepSeek‰∫∫Â∑•Êô∫ËÉΩÂä©ÊâãÂâçÔºåËØ∑ÂÖàËÆæÁΩÆAPIÂØÜÈí•„ÄÇ';
            
            addMessage(messageText, 'ai', welcomeTimestamp);
            
            // Â¶ÇÊûúÊ≤°ÊúâAPIÂØÜÈí•ÔºåÊòæÁ§∫ËÆæÁΩÆÊåâÈíÆ
            if (!apiConfig.key) {
                addApiKeyButton();
            }
        }

        // ‰∏ªÈ¢òÁõ∏ÂÖ≥ÂáΩÊï∞
        function setTheme(theme) {
            const darkIcon = document.getElementById('darkIcon');
            const lightIcon = document.getElementById('lightIcon');
            
            if (theme === 'auto') {
                // Ê£ÄÊµãÁ≥ªÁªü‰∏ªÈ¢òÂÅèÂ•Ω
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    darkIcon.style.display = 'none';
                    lightIcon.style.display = 'block';
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    darkIcon.style.display = 'block';
                    lightIcon.style.display = 'none';
                }
            } else {
                document.documentElement.setAttribute('data-theme', theme);
                if (theme === 'dark') {
                    darkIcon.style.display = 'none';
                    lightIcon.style.display = 'block';
                } else {
                    darkIcon.style.display = 'block';
                    lightIcon.style.display = 'none';
                }
            }
            
            // ‰øùÂ≠ò‰∏ªÈ¢òËÆæÁΩÆ
            apiConfig.uiTheme = theme;
            localStorage.setItem('apiConfig', JSON.stringify(apiConfig));
        }

        // ÊòæÁ§∫Âè≥ÈîÆËèúÂçï
        function showContextMenu(event, chatId) {
            event.preventDefault();
            
            // ‰øùÂ≠òÂΩìÂâçË¢´Êìç‰ΩúÁöÑËÅäÂ§©ID
            activeContextMenuChatId = chatId;
            
            // ÂÆö‰ΩçËèúÂçïÂà∞Èº†Ê†á‰ΩçÁΩÆ
            const menu = document.getElementById('contextMenu');
            menu.style.left = event.pageX + 'px';
            menu.style.top = event.pageY + 'px';
            
            // ÊòæÁ§∫ËèúÂçï
            menu.classList.add('show');
            
            // Ê∑ªÂä†ÁÇπÂáªÂÖ∂‰ªñÂå∫ÂüüÂÖ≥Èó≠ËèúÂçïÁöÑ‰∫ã‰ª∂
            setTimeout(() => {
                document.addEventListener('click', closeContextMenu);
            }, 100);
        }

        // ÂÖ≥Èó≠Âè≥ÈîÆËèúÂçï
        function closeContextMenu() {
            const menu = document.getElementById('contextMenu');
            menu.classList.remove('show');
            document.removeEventListener('click', closeContextMenu);
        }

        // ÂàùÂßãÂåñÂè≥ÈîÆËèúÂçïÈ°πÁÇπÂáª‰∫ã‰ª∂
        function initContextMenuEvents() {
            // ÈáçÂëΩÂêçÂØπËØù
            document.getElementById('menuRename').addEventListener('click', function() {
                const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
                const chat = allChats.find(c => c.id === activeContextMenuChatId);
                
                if (chat) {
                    const chatItem = document.querySelector(`.chat-item[data-chat-id="${activeContextMenuChatId}"]`);
                    const titleSpan = chatItem.querySelector('.chat-title');
                    const oldTitle = titleSpan.textContent;
                    
                    // ÂàõÂª∫ËæìÂÖ•Ê°ÜÊù•ÈáçÂëΩÂêç
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'rename-input';
                    input.value = oldTitle;
                    
                    titleSpan.replaceWith(input);
                    input.focus();
                    input.select();
                    
                    // Â§ÑÁêÜËæìÂÖ•ÂÆåÊàê
                    function completeRename() {
                        const newTitle = input.value.trim() || oldTitle;
                        const newTitleSpan = document.createElement('span');
                        newTitleSpan.className = 'chat-title';
                        newTitleSpan.textContent = newTitle;
                        input.replaceWith(newTitleSpan);
                        
                        // Êõ¥Êñ∞Â≠òÂÇ®
                        chat.title = newTitle;
                        localStorage.setItem('allChats', JSON.stringify(allChats));
                    }
                    
                    input.addEventListener('blur', completeRename);
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            completeRename();
                        }
                    });
                }
            });
            
            // Â§çÂà∂ÂØπËØù
            document.getElementById('menuDuplicate').addEventListener('click', function() {
                const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
                const chat = allChats.find(c => c.id === activeContextMenuChatId);
                
                if (chat) {
                    // ÂàõÂª∫Êñ∞ÁöÑÂØπËØùÂâØÊú¨
                    const newChat = {
                        ...chat,
                        id: 'chat-' + Date.now(),
                        title: chat.title + ' (ÂâØÊú¨)',
                        lastUpdated: new Date().toISOString()
                    };
                    
                    allChats.push(newChat);
                    localStorage.setItem('allChats', JSON.stringify(allChats));
                    updateChatList();
                    showToast('ÂØπËØùÂ∑≤Â§çÂà∂');
                }
            });
            
            // ÂØºÂá∫ÂØπËØù
            document.getElementById('menuExport').addEventListener('click', function() {
                const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
                const chat = allChats.find(c => c.id === activeContextMenuChatId);
                
                if (chat) {
                    // ÂàõÂª∫Ë¶ÅÂØºÂá∫ÁöÑÊï∞ÊçÆÂØπË±°
                    const exportData = {
                        title: chat.title,
                        messages: chat.messages,
                        exportDate: new Date().toISOString()
                    };
                    
                    // ËΩ¨Êç¢‰∏∫JSONÂ≠óÁ¨¶‰∏≤
                    const jsonStr = JSON.stringify(exportData, null, 2);
                    const blob = new Blob([jsonStr], { type: 'application/json' });
                    
                    // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${chat.title.replace(/[^\w\s]/gi, '_')}_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    
                    // Ê∏ÖÁêÜ
                    setTimeout(() => {
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }, 100);
                    
                    showToast('ÂØπËØùÂ∑≤ÂØºÂá∫');
                }
            });
            
            // Âà†Èô§ÂØπËØù
            document.getElementById('menuDelete').addEventListener('click', function() {
                if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂØπËØùÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                    let allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
                    allChats = allChats.filter(c => c.id !== activeContextMenuChatId);
                    
                    localStorage.setItem('allChats', JSON.stringify(allChats));
                    
                    // Â¶ÇÊûúÂà†Èô§ÁöÑÊòØÂΩìÂâçÂØπËØùÔºåÂàõÂª∫Êñ∞ÂØπËØù
                    if (currentChatId === activeContextMenuChatId) {
                        startNewChat();
                    } else {
                        updateChatList();
                    }
                    
                    showToast('ÂØπËØùÂ∑≤Âà†Èô§');
                }
            });
        }

        // Ê∑ªÂä†APIËÆæÁΩÆÊåâÈíÆ
        function addApiKeyButton() {
            const messagesDiv = document.getElementById('chatMessages');
            const lastMessage = messagesDiv.lastChild;
            
            if (lastMessage) {
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'api-key-notice';
                buttonContainer.innerHTML = `
                    <button class="setup-api-btn" onclick="openSettingsModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 10h-4.58l-2.56-2.56a1.94 1.94 0 0 0-1.37-.44H7a1.93 1.93 0 0 0-1.8 1.18L3 14v6a2 2 0 0 0 2 2h13a5 5 0 0 0 5-5v-5a2 2 0 0 0-2-2zM7 10a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        ËÆæÁΩÆAPIÂØÜÈí•
                    </button>
                `;
                lastMessage.appendChild(buttonContainer);
            }
        }

        // ÊêúÁ¥¢ËÅäÂ§©ËÆ∞ÂΩï
        function initSearchFunction() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            
            // ÊêúÁ¥¢ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            searchBtn.addEventListener('click', performSearch);
            
            // ÊêúÁ¥¢Ê°ÜËæìÂÖ•‰∫ã‰ª∂
            searchInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
                // Â¶ÇÊûúÊêúÁ¥¢Ê°Ü‰∏∫Á©∫ÔºåÊÅ¢Â§çÊâÄÊúâËÅäÂ§©ÊòæÁ§∫
                if (this.value.trim() === '') {
                    updateChatList();
                }
            });
            
            // ÊêúÁ¥¢ÂäüËÉΩÂÆûÁé∞
            function performSearch() {
                const searchTerm = searchInput.value.trim().toLowerCase();
                if (!searchTerm) {
                    // Â¶ÇÊûúÊêúÁ¥¢ËØç‰∏∫Á©∫ÔºåÊòæÁ§∫ÊâÄÊúâËÅäÂ§©
                    updateChatList();
                    return;
                }
                
                // Ëé∑ÂèñÊâÄÊúâËÅäÂ§©
                const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
                
                // ÊåâÂÖ≥ÈîÆËØçËøáÊª§
                const filteredChats = allChats.filter(chat => {
                    // ÊêúÁ¥¢Ê†áÈ¢ò
                    if (chat.title.toLowerCase().includes(searchTerm)) return true;
                    
                    // ÊêúÁ¥¢Ê∂àÊÅØÂÜÖÂÆπ
                    return chat.messages.some(msg => 
                        msg.content.toLowerCase().includes(searchTerm)
                    );
                });
                
                // Êõ¥Êñ∞ËÅäÂ§©ÂàóË°®UI
                displayFilteredChats(filteredChats, searchTerm);
            }
            
            // ÊòæÁ§∫ËøáÊª§ÂêéÁöÑËÅäÂ§©È°π
            function displayFilteredChats(chats, searchTerm) {
                const chatListDiv = document.querySelector('.chat-list');
                
                // ‰øùÁïôÂ§¥ÈÉ®ÂíåÊêúÁ¥¢Ê†è
                const headerDiv = chatListDiv.querySelector('.chat-list-header');
                const searchContainer = chatListDiv.querySelector('.search-container');
                
                // Ê∏ÖÁ©∫ÂΩìÂâçËÅäÂ§©ÂàóË°®Ôºå‰ΩÜ‰øùÁïôÂ§¥ÈÉ®ÂíåÊêúÁ¥¢Ê†è
                chatListDiv.innerHTML = '';
                chatListDiv.appendChild(headerDiv);
                chatListDiv.appendChild(searchContainer);
                
                // ÊêúÁ¥¢ÁªìÊûú‰∏∫Á©∫ÊòæÁ§∫ÊèêÁ§∫
                if (chats.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-search-results';
                    noResults.innerHTML = `
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                        <p>Êú™ÊâæÂà∞ÂåÖÂê´"${searchTerm}"ÁöÑÂØπËØù</p>
                    `;
                    chatListDiv.appendChild(noResults);
                    return;
                }
                
                // ÊòæÁ§∫ÊêúÁ¥¢ÁªìÊûúÊï∞Èáè
                const resultCount = document.createElement('div');
                resultCount.className = 'search-result-count';
                resultCount.textContent = `ÊâæÂà∞ ${chats.length} Êù°Áõ∏ÂÖ≥ÂØπËØù`;
                chatListDiv.appendChild(resultCount);
                
                // Ê∑ªÂä†ËøáÊª§ÂêéÁöÑËÅäÂ§©È°π
                chats.forEach(chat => {
                    const chatItemDiv = document.createElement('div');
                    chatItemDiv.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                    chatItemDiv.dataset.chatId = chat.id;
                    
                    // È´ò‰∫ÆÊòæÁ§∫ÂåπÈÖçÁöÑÊ†áÈ¢ò
                    let title = chat.title;
                    if (title.toLowerCase().includes(searchTerm)) {
                        const index = title.toLowerCase().indexOf(searchTerm);
                        title = title.substring(0, index) + 
                                `<span class="search-highlight">${title.substring(index, index + searchTerm.length)}</span>` + 
                                title.substring(index + searchTerm.length);
                    }
                    
                    chatItemDiv.innerHTML = `
                        <span class="chat-icon">üí¨</span>
                        <span class="chat-title">${title}</span>
                    `;
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    chatItemDiv.addEventListener('click', () => loadChat(chat.id));
                    
                    // Ê∑ªÂä†Âè≥ÈîÆËèúÂçï‰∫ã‰ª∂
                    chatItemDiv.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        showContextMenu(e, chat.id);
                    });
                    
                    chatListDiv.appendChild(chatItemDiv);
                });
            }
        }

        // Âú®È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩ
        document.addEventListener('DOMContentLoaded', () => {
            // ... Áé∞Êúâ‰ª£Á†Å ...
            
            // ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩ
            initSearchFunction();
        });

        // ‰øÆÊîπupdateChatListÂáΩÊï∞Ôºå‰ΩøÂÖ∂‰øùÁïôÊêúÁ¥¢Ê†è
        function updateChatList() {
            // Êõ¥Êñ∞‰æßËæπÊ†èÁöÑËÅäÂ§©ÂàóË°®
            const allChats = JSON.parse(localStorage.getItem('allChats') || '[]');
            const chatListDiv = document.querySelector('.chat-list');
            
            // ‰øùÁïôÂ§¥ÈÉ®
            const headerDiv = chatListDiv.querySelector('.chat-list-header');
            // ‰øùÁïôÊêúÁ¥¢Ê†è
            const searchContainer = chatListDiv.querySelector('.search-container') || document.createElement('div');
            if (!searchContainer.classList.contains('search-container')) {
                searchContainer.className = 'search-container';
                searchContainer.innerHTML = `
                    <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢ÂØπËØùÂéÜÂè≤..." />
                    <button id="searchBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                `;
                // ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩ
                setTimeout(initSearchFunction, 0);
            }
            
            chatListDiv.innerHTML = '';
            chatListDiv.appendChild(headerDiv);
            chatListDiv.appendChild(searchContainer);
            
            // ÊåâÊúÄÂêéÊõ¥Êñ∞Êó∂Èó¥ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÈù¢Ôºâ
            allChats.sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated));
            
            // Ê∑ªÂä†ÊâÄÊúâÂØπËØù
            allChats.forEach(chat => {
                const chatItemDiv = document.createElement('div');
                chatItemDiv.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                chatItemDiv.dataset.chatId = chat.id;
                chatItemDiv.innerHTML = `
                    <span class="chat-icon">üí¨</span>
                    <span class="chat-title">${chat.title}</span>
                `;
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                chatItemDiv.addEventListener('click', () => loadChat(chat.id));
                
                // Ê∑ªÂä†Âè≥ÈîÆËèúÂçï‰∫ã‰ª∂
                chatItemDiv.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    showContextMenu(e, chat.id);
                });
                
                chatListDiv.appendChild(chatItemDiv);
            });
        }

        // Âú®bodyÊ†áÁ≠æÂºÄÂßãÂêéÊ∑ªÂä†ÁßªÂä®ÂØºËà™Ê†è
        document.addEventListener('DOMContentLoaded', function() {
            // Âè™Âú®Â∞èÂ±èÂπïËÆæÂ§á‰∏äÊ∑ªÂä†ÁßªÂä®ÂØºËà™Ê†è
            if (window.innerWidth <= 768) {
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    const mobileNavbar = document.createElement('div');
                    mobileNavbar.className = 'mobile-navbar';
                    mobileNavbar.innerHTML = `
                        <button class="menu-toggle" id="mobileMenuToggle">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <line x1="3" y1="18" x2="21" y2="18"></line>
                            </svg>
                        </button>
                        <span>DeepSeek AI</span>
                        <div style="width: 24px;"></div>
                    `;
                    mainContent.insertBefore(mobileNavbar, mainContent.firstChild);
                }
                
                // Âè™Âú®Â∞èÂ±èÂπïËÆæÂ§á‰∏äÂàõÂª∫‰æßËæπÊ†èÈÅÆÁΩ©Â±Ç
                const overlay = document.createElement('div');
                overlay.className = 'sidebar-overlay';
                document.body.appendChild(overlay);
                
                // Ê∑ªÂä†‰æßËæπÊ†èÂàáÊç¢ÂäüËÉΩ
                initMobileNavigation();
            }
            
            // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñÔºåÂä®ÊÄÅÊ∑ªÂä†ÊàñÁßªÈô§ÁßªÂä®ÂØºËà™Ê†è
            window.addEventListener('resize', function() {
                const existingNavbar = document.querySelector('.mobile-navbar');
                const existingOverlay = document.querySelector('.sidebar-overlay');
                
                if (window.innerWidth <= 768) {
                    // Â∞èÂ±èÂπïËÆæÂ§áÔºåÊ∑ªÂä†ÁßªÂä®ÂØºËà™Ê†èÔºàÂ¶ÇÊûú‰∏çÂ≠òÂú®Ôºâ
                    if (!existingNavbar) {
                        const mainContent = document.querySelector('.main-content');
                        if (mainContent) {
                            const mobileNavbar = document.createElement('div');
                            mobileNavbar.className = 'mobile-navbar';
                            mobileNavbar.innerHTML = `
                                <button class="menu-toggle" id="mobileMenuToggle">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="3" y1="12" x2="21" y2="12"></line>
                                        <line x1="3" y1="6" x2="21" y2="6"></line>
                                        <line x1="3" y1="18" x2="21" y2="18"></line>
                                    </svg>
                                </button>
                                <span>DeepSeek AI</span>
                                <div style="width: 24px;"></div>
                            `;
                            mainContent.insertBefore(mobileNavbar, mainContent.firstChild);
                        }
                        
                        // Ê∑ªÂä†ÈÅÆÁΩ©Â±ÇÔºàÂ¶ÇÊûú‰∏çÂ≠òÂú®Ôºâ
                        if (!existingOverlay) {
                            const overlay = document.createElement('div');
                            overlay.className = 'sidebar-overlay';
                            document.body.appendChild(overlay);
                        }
                        
                        // ÂàùÂßãÂåñÁßªÂä®ÂØºËà™ÂäüËÉΩ
                        initMobileNavigation();
                    }
                } else {
                    // Â§ßÂ±èÂπïËÆæÂ§áÔºåÁßªÈô§ÁßªÂä®ÂØºËà™Ê†èÂíåÈÅÆÁΩ©Â±Ç
                    if (existingNavbar) {
                        existingNavbar.remove();
                    }
                    if (existingOverlay) {
                        existingOverlay.remove();
                    }
                    
                    // Á°Æ‰øù‰æßËæπÊ†èÂèØËßÅ‰∏îÊ†∑ÂºèÊ≠£Á°Æ
                    const sidebar = document.querySelector('.sidebar');
                    if (sidebar) {
                        sidebar.classList.remove('show-mobile');
                        sidebar.style.left = '';
                    }
                    
                    // ÈáçÁΩÆbodyÊ†∑Âºè
                    document.body.style.overflow = '';
                }
            });
        });

        // ÂàùÂßãÂåñÁßªÂä®ÂØºËà™ÂäüËÉΩ
        function initMobileNavigation() {
            const menuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (!menuToggle || !sidebar || !overlay) return;
            
            // ÁÇπÂáªËèúÂçïÊåâÈíÆÊòæÁ§∫‰æßËæπÊ†è
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('show-mobile');
                overlay.classList.toggle('show');
                document.body.style.overflow = sidebar.classList.contains('show-mobile') ? 'hidden' : '';
            });
            
            // ÁÇπÂáªÈÅÆÁΩ©Â±ÇÂÖ≥Èó≠‰æßËæπÊ†è
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('show-mobile');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            });
            
            // ÁÇπÂáª‰æßËæπÊ†è‰∏≠ÁöÑËÅäÂ§©È°πÂêéÂÖ≥Èó≠‰æßËæπÊ†è
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('show-mobile');
                        overlay.classList.remove('show');
                        document.body.style.overflow = '';
                    }
                });
            });
            
            // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñÔºåÂú®Â§ßÂ±èÂπï‰∏ãÈáçÁΩÆÊ†∑Âºè
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    sidebar.classList.remove('show-mobile');
                    overlay.classList.remove('show');
                    document.body.style.overflow = '';
                }
            });
        }

        // ‰øÆÊîπÁé∞ÊúâÁöÑupdateChatListÂáΩÊï∞ÔºåÁ°Æ‰øù‰∏∫Êñ∞Ê∑ªÂä†ÁöÑËÅäÂ§©È°πÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
        const originalUpdateChatList = updateChatList;
        updateChatList = function() {
            originalUpdateChatList.apply(this, arguments);
            
            // ‰∏∫Êñ∞Ê∑ªÂä†ÁöÑËÅäÂ§©È°πÊ∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÁõëÂê¨Âô®
            if (window.innerWidth <= 768) {
                const chatItems = document.querySelectorAll('.chat-item');
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                chatItems.forEach(item => {
                    item.addEventListener('click', function() {
                        sidebar.classList.remove('show-mobile');
                        overlay.classList.remove('show');
                        document.body.style.overflow = '';
                    });
                });
            }
        };
    </script>
</body>
</html>